{"version":3,"file":"environment.js","sources":["../sources/environment.mjs"],"sourcesContent":["const preferences = {\n  classic: false,\n  dynamic: false,\n};\n\nconst platform = {\n  modules: typeof chrome === 'object',\n};\n\nconst MODULES =\n  platform.modules && (preferences.modules || !preferences.classic);\nconst DYNAMIC = !MODULES || preferences.dynamic;\nconst OPTIONS = { type: MODULES ? 'module' : 'classic' };\n\nconst [, EXT] = /[^/]+(\\.m?js)/.exec(import.meta.url);\n\nexport const { Log, CurrentScope } = Debugging();\n\nconst prefix = `languages/`;\nconst mappings = {};\n\nconst defaultBase = `${new URL(`.`, import.meta.url)}`;\n\nconst aliases = {\n  default: 'editor',\n  json: 'json',\n  jsonc: 'json',\n  css: 'css',\n  html: 'html',\n  js: 'ts',\n  javascript: 'ts',\n  ts: 'ts',\n  typescript: 'ts',\n};\n\nconst paths = {\n  editor: `monaco/editor.worker${EXT}`,\n  css: `${prefix}css/css.worker${EXT}`,\n  json: `${prefix}json/json.worker${EXT}`,\n  html: `${prefix}html/html.worker${EXT}`,\n  ts: `${prefix}ts/ts.worker${EXT}`,\n};\n\nconst resolve = (alias, base) => {\n  let mapping = mappings[alias];\n  if (!mapping) {\n    const name = aliases[alias] || 'editor';\n    mapping = mappings[alias] = `${new URL(\n      `./${paths[name]}`,\n      base || defaultBase,\n    )}`;\n  }\n  return mapping;\n};\n\nexport const getWorker = (moduleID, label, base, dynamic = DYNAMIC) => {\n  const mode = aliases[label] || aliases.default;\n  const src = resolve(mode, base);\n  const url = getWorkerURL(base, src, dynamic);\n  const options = OPTIONS;\n  const worker = new Worker(url, options);\n  Log(() => [\n    'getWorker(%o, %o) => %O',\n    moduleID,\n    label,\n    { worker, mode, src, url, options },\n  ]);\n  return worker;\n};\n\nconst getWorkerURL = (base, src, dynamic = DYNAMIC) =>\n  dynamic\n    ? `${new URL(`./worker${EXT}`, base)}#${src.replace(base, '')}`\n    : `${src}`;\n\nexport default (base = defaultBase) => ({\n  base,\n  getWorker(moduleID, label) {\n    return getWorker(moduleID, label, this.base);\n  },\n});\n\nfunction Debugging() {\n  const { setPrototypeOf, defineProperties, defineProperty, freeze } = Object;\n  const debugging = {};\n  const namespace = {};\n  const noop = freeze(a => a);\n  const configurable = true;\n\n  Debugging = () => debugging;\n\n  const imports = import(`./debugging${EXT}`)\n    .then(imports => {\n      const descriptors = {};\n      for (const k in imports)\n        descriptors[k] = { get: () => namespace[k], configurable };\n      defineProperties(debugging, descriptors);\n      return setPrototypeOf(namespace, imports);\n    })\n    .catch(r => console.warn(r) || namespace);\n\n  const apply = async (k, args) => {\n    const [n, ...p] = await Promise.all([imports, ... await args]);\n    return Reflect.apply(namespace[k] || noop, null, p);\n  };\n\n  const proxy = new Proxy(setPrototypeOf(new class Debugging { }(), null), {\n    get: (t, k) =>\n      (k &&\n        typeof k === 'string' &&\n        defineProperty(debugging, k, {\n          value: ƒ => apply(k, ƒ()),\n          configurable,\n        })[k]) ||\n      noop,\n  });\n\n  return setPrototypeOf(debugging, proxy);\n}\n"],"names":[],"mappings":"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"}